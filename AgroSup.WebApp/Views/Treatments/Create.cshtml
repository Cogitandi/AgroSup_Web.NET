@model IList<AgroSup.WebApp.ViewModels.Manages.Treatments.AddTreatmentViewModel>

@{
    ViewData["Title"] = "Dodaj zabiegi";
    ViewData["ActivePage"] = ManageMenu.TreatmentAdd;
    var treatmentModel = new AgroSup.WebApp.ViewModels.Manages.Treatments.AddTreatmentViewModel();
}

<div class="row">
    <partial name="_ManageMenuPartial" />
    <div class="col-md-10">
        <div class="container-md mx-4">
            <h2 class="text-center">Zabiegi</h2>
            <hr />
            <!--- Content -->
            <form asp-action="Create" id="form">
                <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                <input class="btn btn-info mb-2" type="button" id="addTreatment" value="Nowy zabieg" />
                <table class="table">
                    <thead>
                        <tr>
                            <th>
                                @Html.DisplayNameFor(model => treatmentModel.Name)
                            </th>
                            <th>
                                @Html.DisplayNameFor(model => treatmentModel.Date)
                            </th>
                            <th>
                                @Html.DisplayNameFor(model => treatmentModel.FieldId)
                            </th>
                            <th>
                                @Html.DisplayNameFor(model => treatmentModel.Notes)
                            </th>
                            <th>
                                @Html.DisplayNameFor(model => treatmentModel.DosePerHa)
                            </th>
                            <th>
                                @Html.DisplayNameFor(model => treatmentModel.SprayingAgents)
                            </th>
                            <th>
                                @Html.DisplayNameFor(model => treatmentModel.FertilizerId)
                            </th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody id="treatments">
                    </tbody>
                </table>
                <div class="form-group">
                    <input type="submit" value="Dodaj zabiegi" class="btn btn-primary" />
                </div>
            </form>
            <!--- End content -->
            <!--- Content -->
            <!--<form asp-action="AddTreatment" id="form">
                <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                <input class="btn btn-info mb-2" type="button" id="addTreatment" value="Nowy zabieg" />
                <div id="treatments">
                </div>
                <div class="form-group">
                    <input type="submit" value="Dodaj zabiegi" class="btn btn-primary" />
                </div>
            </form>-->
            <!--- End content -->
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function showHideInputs() {
            var value = $(this).val();
            var inputs = $(this).parent().parent().siblings();
            switch (value) {
                case 'Fertilizer':
                    inputs.find('input[name$=Date]').prop("disabled", false);
                    inputs.find('select[name$=FieldId]').prop("disabled", false);
                    inputs.find('input[name$=Dose]').prop("disabled", false);
                    inputs.find('input[name$=Notes]').prop("disabled", false);
                    inputs.find('input[name$=Agents]').prop("disabled", true);
                    inputs.find('select[name$=FertilizerId]').prop("disabled", false);
                    break;
                case 'Seeding':
                   inputs.find('input[name$=Date]').prop("disabled", false);
                    inputs.find('select[name$=FieldId]').prop("disabled", false);
                    inputs.find('input[name$=Dose]').prop("disabled", false);
                    inputs.find('input[name$=Notes]').prop("disabled", false);
                   inputs.find('input[name$=Agents]').prop("disabled", true);
                   inputs.find('select[name$=FertilizerId]').prop("disabled", true);
                    break;
                case 'Spraying':
                   inputs.find('input[name$=Date]').prop("disabled", false);
                    inputs.find('select[name$=FieldId]').prop("disabled", false);
                    inputs.find('input[name$=Dose]').prop("disabled", true);
                    inputs.find('input[name$=Notes]').prop("disabled", false);
                   inputs.find('input[name$=Agents]').prop("disabled", false);
                   inputs.find('select[name$=FertilizerId]').prop("disabled", true);
                    break;
                case 'none':
                   inputs.find('input[name$=Date]').prop("disabled", true);
                    inputs.find('select[name$=FieldId]').prop("disabled", true);
                    inputs.find('input[name$=Dose]').prop("disabled", true);
                    inputs.find('input[name$=Notes]').prop("disabled", true);
                   inputs.find('input[name$=Agents]').prop("disabled", true);
                   inputs.find('select[name$=FertilizerId]').prop("disabled", true);
                    break;
            }
        }
        ///
        $("#addTreatment").on("click", function () {
        $.ajax({
            async: true,
            data: $("#form").serialize(),
            type: "POST",
            url: '@Url.Action("AddTreatment", "Treatments")',
            success: function (partialView) {
                $('#treatments').html(partialView);
                $('#treatments').find('select[name$=Name]').each(function () {
                    showHideInputs.call(this)
                });
            }
        });
        });

        function removeParcel() {
            //data: $("#form").serialize() + "&index=" + indexToRemove,
            //data: $("#form").serialize() + id:indexToRemove,
            var indexToRemove = $(this).parent().parent().parent().prevAll().length;
            //var data
            $.ajax({
                async: true,
                data: $("#form").serialize() + "&index=" + indexToRemove,
            type: "POST",
            url: '@Url.Action("RemoveTreatment", "Treatments")',
                success: function (partialView) {
                    $('#treatments').html(partialView);
                    $('#treatments').find('select[name$=Name]').each(function () {
                        showHideInputs.call(this)
                    });
            }
        });
            event.preventDefault();
        }
    </script>
}